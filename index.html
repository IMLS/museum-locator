<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Museum Locator</title>

    <!-- Bootstrap css -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

     <!-- CartoDB css -->
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />

    <!-- Bootstrap css -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />

    <!-- DataTables css -->
    <!-- <link rel="stylesheet" href="http://cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css" /> -->
    
    <!-- default custom css -->
    <link href="css/starter-template.css" rel="stylesheet">

    <style>
      html, body {width:100%; height:100%; padding: 10; margin: 0;}
      #cartodb-map { width: 80%; height:100%; background: black; margin-left: 20%;}
    </style>

    <!-- DataTables js -->  
    <!-- <script src="http://cdn.datatables.net/1.10.5/js /jquery.dataTables.min.js"></script> -->

    <!-- CartoDB js -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>

    <!-- Bootstrap js -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!-- jQuery js -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <!-- initialize datatable 
    <script class="init">
      $(document).ready(function() {
        $('#MyDataTable').DataTable();
      });
    </script>
    -->
    <!-- initialize cartodb map -->
    <script>
    var map;

    // get current location
    // var x = document.getElementById("demo");
    // function getLocation() {
    //   if (navigator.geolocation) {
    //     navigator.geolocation.getCurrentPosition(showPosition);
    //   } else {
    //     x.innerHTML = "Geolocation is not supported by this browser.";
    //   }
    // }
    // function showPosition(position) {
    //   x.innerHTML = "Latitude: " + position.coords.latitude + 
    //   "<br>Longitude: " + position.coords.longitude; 
    // }

    //var 

    //var qcount = $.getJSON(URL, function(json)){
    //   console.log( "JSON Data: " + json.count);
    //    alert(json.count);
    //});

    // Display count and name 
    //function displayQuery(){
    //  alert("displayQuery");
    //  URL = "https://imls.cartodb.com/api/v2/sql?q=SELECT count(*) FROM mudf15q1pub";
    //}

    // Create layer selector
    function createSelector(layer) {

      var sql =  new cartodb.SQL({ user: 'imls' });

      var $options = $(".layer_selector").find("li");
      $options.click(function(e) {

          // get the area of the selected layer
          var $li = $(e.target);
          var selected = $li.attr('data');

          // deselect all and select the clicked one
          $options.removeClass('selected');
          $li.addClass('selected');

          // create query based on data from the layer
          var query = "select * from mudf15q1pub";

          if(selected !== "ALL") {
            query = "select * from mudf15q1pub where discipl='" + selected + "'";
          }
          // change the query in the layer to update the map
          //layer.setQuery(query);
          layer.setSQL(query)
      });
    }

    function init(){
      // initiate leaflet map
      map = new L.Map('cartodb-map', { 
        center: [40,-98],
        zoom: 4
      })

      L.tileLayer('https://dnv9my2eseobd.cloudfront.net/v3/cartodb.map-4xtxp73f/{z}/{x}/{y}.png', {
        attribution: 'Mapbox <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
      }).addTo(map);

      var layerUrl = 'http://imls.cartodb.com/api/v2/viz/6e1e4e64-ce7a-11e4-be57-0e018d66dc29/viz.json';

       // change the query for the first layer
      var subLayerOptions = [{
      sql: "SELECT * FROM mudf15q1pub",
      cartocss: "#mudf15q1pub{marker-line-opacity: 1; marker-placement: point; marker-width: 10; marker-type: ellipse; marker-line-color: #FFF; marker-line-width: 1.5; marker-allow-overlap: false;} #mudf15q1pub[discipl='HSC'] {marker-fill:#A6CEE3;} #mudf15q1pub[discipl='GMU'] {marker-fill:#1F78B4;} #mudf15q1pub[discipl='HST'] {marker-fill:#B2DF8A;} #mudf15q1pub[discipl='ART'] {marker-fill:#33A02C;} #mudf15q1pub[discipl='BOT'] {marker-fill:#FB9A99;} #mudf15q1pub[discipl='ZAW'] {marker-fill:#E31A1C;} #mudf15q1pub[discipl='SCI'] {marker-fill:#FDBF6F;} #mudf15q1pub[discipl='CMU'] {marker-fill:#FF7F00;} #mudf15q1pub[discipl='NAT'] {marker-fill: #CAB2D6;}"
      }]

      // For storing the sublayer
      var sublayer;

    //   // add data layer to map
    //   cartodb.createLayer(map, layerUrl)
    //     .addTo(map)
    //     .on('done', function(vis, layers) {
    //        //layer.getSubLayer(0).set(subLayerOptions);
    //        sublayer = layer.getSubLayer(0);
    //        createSelector(sublayer);
    //        //createSelector(layers[0])
    //     }).on('error', function() {
    //       //log the error
    //       console.log("error: " + err);
    //    });
    // }

     // Add data layer to your map
    cartodb.createLayer(map, layerUrl)
     .addTo(map)
     .done(function(layer) {
        sublayer = layer.getSubLayer(0);
        createSelector(sublayer);
        //var vs = cdb.vis.Overlay.create('search',map.viz,{});
        //vs.show();
        //$('#map').append(vs.render().el);
      })
     .error(function(err) {
        console.log("error: " + err);
      });
    }
    </script>
  </head>

  <body onload="init()">
     <nav class="navbar navbar-inverse navbar-fixed-top" style="background: #ADD8E6">
      <div class="container" >
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#" style="color:white">Museum Locator</a>
        </div>
        <!--
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
          </ul>
        </div>/.nav-collapse -->
      </div>
    </nav>

    <div id="awrapper" style="width:100%; height:100%;">

      <div id="interface_container" style="width:20%; float:left; padding-left: 10px; padding-top: 10px">

             <!-- <div id="search_selector">
                <input type="text" value="search" onclick='Clear(this);'>
                <div id="search" class="btn btn-default">Go!</div>
                <hr>
             </div>
            -->
<!--              <div id="findnear" class="btn-group">
               <div id="findme" class="btn btn-default" onclick="getLocation()">Find Near Me</div>
             </div> 
            <div><hr></div>
             -->

             

             <div id="dropselect" class="layer_selector cartodb_infobox btn-group">
             <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#">Select Museum Type
                 <span class="caret"></span>
             </a>
             <ul class="dropdown-menu" role="menu">
                 <li><a href="#" data="ALL" class="selected"> SHOW ALL MUSEUMS </a></li>
                 <li><a href="#" data="GMU">General Museums/Uncategorized</a></li>
                 <li><a href="#" data="ART">Art Museums</a></li>
                 <li><a href="#" data="CMU">Children's Museums</a></li>
                 <li><a href="#" data="BOT">Arboretums, Botanical Gardens, &amp; Nature Centers</a></li>
                 <li><a href="#" data="ZAW">Zoos, Aquariums, &amp; Wildlife Conservation </a></li>
                 <li><a href="#" data="HST">History Museums </a></li>
                 <li><a href="#" data="NAT">Natural History &amp; Natural Science Museums</a></li>
                 <li><a href="#" data="HSC">Historical Societies &amp; Historic Preservation</a></li>
                 <li><a href="#" data="SCI">Science &amp; Technology Museums</a></li>
             </ul>
          </div>
          <div><hr></div>
          <div id="about_blurb">
          <h3>About Data</h3>
          <p>This data comes from the <a href="www.imls.gov">Institute of Museum and Library Services</a> <a href="http://www.imls.gov/research/museum_universe_data_file.aspx">Museum Universe Data File (MUDF)</a> which contains basic identifying information of known museums and related organizations in the United States.</p></div>
          <div id="download" class="btn btn-default"><a href="http://www.imls.gov/assets/1/AssetManager/mudf15q1pub_csv.zip">Download this data</a></div>
      </div>
      <div id='cartodb-map'></div>
      <!--
      <div id='datatable'>
          <table id="MyDataTable" class="display" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>Column 1</th>
                    <th>Column 2</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Row 1 Data 1</td>
                    <td>Row 1 Data 2</td>
                </tr>
                <tr>
                    <td>Row 2 Data 1</td>
                    <td>Row 2 Data 2</td>
                </tr>
            </tbody>
          </table>
      </div>
    </div>
    -->

<!--
    <div class="container">

      <div class="starter-template">
-->
    </div><!-- /.container -->
    </div>
          
  </body>
</html>